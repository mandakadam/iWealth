app._reload=!1,app.login={},app.instance.dv.loginview=null,$(document).ready(function(){$(document).ajaxError(function(a,b,c){"401"==b.status||"403"==b.status?app.login.backtoScreen():console.log(b)}).ajaxStart(function(){app.showSpinner("body")}).ajaxStop(function(){app.hideSpinner("body")});var a=Backbone.Router.extend({routes:{"":"login",mainpage:"mainpage",forgetPassword:"forgetPassword","*path":"login"},login:function(){window.sessionStorage.getItem("_ticket")?_app_route.navigate("mainpage",{trigger:!0}):app.instance.dv.loginview?app.instance.dv.loginview.render():app.instance.dv.loginview=new LoginView({el:"#logincontent"})},mainpage:function(a){$("#logincontent").fadeOut(),$("body").removeClass("login-page");var b=new MainPageView({el:"#mainpagecontent"});b.render(),app.main.getModuleList(),app.getUserSettings()},forgetPassword:function(){new fgtPassView({el:"#logincontent"})}});MainPageView=Backbone.View.extend({initialize:function(){this.mainpage=$("#mainpagetemplate").html()},render:function(){return $(this.el).html(this.mainpage).fadeIn(),this}}),LoginView=Backbone.View.extend({initialize:function(){var a=this;$.get(app.applicationurl+"app/template/login/login.htm",function(b){a.loginpage=b,a.render()})},events:{"click #btnSubmit":"login_press"},render:function(){return $("#mainpagecontent").fadeOut(),$("#logincontent").fadeIn(),this.$el.html(this.loginpage),$("body").addClass("login-page"),this},login_press:function(a){app.login.onlogin()}}),fgtPassView=Backbone.View.extend({events:{"click #btnCancelFP":"backToLoginScreen","click #btnResetPass":"resetPassword"},initialize:function(){var a=this;$.get(app.applicationurl+"app/template/login/forgotpwd.htm",function(b){a.FPPage=b,a.render()})},render:function(){this.$el.html(this.FPPage)},backToLoginScreen:function(){app.login.backtoScreen()},resetPassword:function(a){a.preventDefault(),app.login.onForgetPassword()}}),app.getApplicationSettings(),_app_route=new a,Backbone.history.start()}),app.login.processLogin=function(ctoken,objForm){var cToken=ctoken+"",hashObj="";objForm.ctoken.value=ctoken,"application"==document.getElementById("authMode").innerHTML&&(hashObj=new jsSHA(objForm.password.value,"TEXT"),hashObj=hashObj.getHash("SHA-512","HEX"),hashObj+=cToken,hashObj=new jsSHA(hashObj,"TEXT"),hashObj=hashObj.getHash("SHA-512","HEX"),objForm.password.value=hashObj),$.post(app.applicationurl+"REST/create/apiticket/generatewebticket?_reload="+app._reload,$(objForm).serialize(),function(vobj){try{vobj=eval("("+vobj+")")}catch(e){return $("#frmlogin #loginValid").html("Error while login").show(),objForm.user_id.value="",void(objForm.password.value="")}return"success"!=vobj.status?($("#frmlogin #loginValid").html(vobj.error).show(),objForm.user_id.value="",void(objForm.password.value="")):(window.sessionStorage.setItem("_ticket",vobj.webticket),window.sessionStorage.setItem("_user_id",objForm.user_id.value),app._ticket=vobj.webticket,void _app_route.navigate("mainpage",{trigger:!0}))})},getSession=function(){return window.sessionStorage.getItem("_ticket")},app.getData=function(a){if(a)return window.sessionStorage.getItem(a)},app.login.backtoScreen=function(){window.sessionStorage.setItem("_ticket",""),window.sessionStorage.setItem("_user_id",""),app.destroyObjects(),_app_route.navigate("",{trigger:!0})},app.login.onForgetPassword=function(){var emailaddress=$("#frmforgotpwd #txt_email").prop("value")||"";return""==emailaddress?void $("#frmforgotpwd #passwordmsg").html("Please enter email address"):void app.sendRequest({url:"REST/update/apiticket/forgotpassword",fn:function(response){response=eval("("+response+")"),"success"==response.status?(alert("Password has been mailed to your email address."),app.login.backtoScreen()):$("#frmforgotpwd #passwordmsg").html("Opps!!! Have encountered an error while emailing the password.")},async:!0,data:{sessionid:app.getData("_ticket"),user_id:emailaddress}})},app.login.onlogin=function(e){$("#frmlogin #loginValid").hide().html("");var objForm=document.frmlogin,vUser=objForm.user_id.value,vPass=objForm.password.value;return""==vUser?($("#frmlogin #loginValid").html("Please enter email address").show(),void(objForm.password.value="")):""==vPass?($("#frmlogin #loginValid").html("Please enter your password").show(),void(objForm.password.value="")):void app.sendRequest({url:"REST/create/apiticket/generatetoken",fn:function(response){return response=eval("("+response+")"),"success"==response.status?void app.login.processLogin(response.token,objForm):($("#frmlogin #loginValid").html("Error while login.").show(),objForm.user_id.value="",void(objForm.password.value=""))},async:!0,data:{_ticket:app.getData("_ticket")}})},app.destroyObjects=function(){for(var a in app.instance.dv)if(app.instance.dv[a]){if("loginview"==a)continue;console.debug("Unbind "+a),app.instance.dv[a].unbind(),app.instance.dv[a]=null}},app.trade={},app.instance.dv.HoldingView=null,app.instance.dv.AssetHoldingView=null,app.dv.HoldingView=Backbone.View.extend({initialize:function(a){var b=this;$("#module_V1").append('<div class="holding-refresh" onclick="app.onGetHolding();"><i class="fa fa-refresh"></i></div>'),$("#module_V1 a").addClass("holding-mod-cls"),this.paramhtml=a.paramhtml;var c='{{#tdata}}<div class="row"><div class="col-md-12 col-sm-12 col-xs-12"><div class="box cls-holding-box-shadow">';c+='<div class="box-body {{clsbg}}"><div class="row">',c+='<div class="col-md-10 col-sm-10 col-xs-10"><div class="row">',c+='<div class="col-md-12 col-sm-12 col-xs-12">',c+='<label class="cls-lbl-holding-amt">${{#commaSeparate}}{{marketvalue}}{{/commaSeparate}}</label></div></div><div class="row">',c+='<div class="col-md-12 col-sm-12 col-xs-12"><label class="cls-lbl-holding-perc">{{gainloss_perc}}%</label>',c+='<span class="cls-holding-caret-arrow"><i class="{{clsarrow}}"></i></span>',c+='<label class="cls-lbl-holding-ac" ><i>Account : {{accountid}} </i>',c+='</label></div></div></div><div class="col-md-2 col-sm-2 col-xs-2">',c+='<div class="pull-right cls-holding-links"><a href="#Holding/asset/{{accountid}}" class="cls-holding-arrow"><i class="fa  fa-angle-right fa-5x"></i></a></div>',c+="</div></div></div></div></div></div>{{/tdata}}",this.accountTpl=c,app.dc.holdingCollection.on("reset",this.render,this),$.get(a.paramhtml,function(a){b.holdingpage=a,app.dc.holdingCollection.fetch({reset:!0})}),_app_route.route("Holding/asset/:accountnumber","Holding/asset/",function(a){app.instance.dv.AssetHoldingView?(app.instance.dv.AssetHoldingView.accountnumber=a,app.instance.dv.AssetHoldingView.render()):app.instance.dv.AssetHoldingView=new app.dv.AssetHoldingView({el:"#maincontent",accountnumber:a})})},render:function(){app.trade.loadAccountHoldingView(this)}}),app.dv.AssetHoldingView=Backbone.View.extend({initialize:function(a){var b=this;this.accountnumber=a.accountnumber,this.assettpl="",this.assettpl=this.assettpl+'{{#tdata}}<div class="row"><div class="col-md-12 col-sm-12 col-xs-12"><div class="box cls-holding-box-shadow">',this.assettpl=this.assettpl+'<div class="box-body {{clsbg}}"><div class="row">',this.assettpl=this.assettpl+'<div class="col-md-8 col-sm-8 col-xs-8"><div class="row">',this.assettpl=this.assettpl+'<div class="col-md-12 col-sm-12 col-xs-12"><label class="cls-lbl-holding-amt">${{#commaSeparate}}{{marketvalue}}{{/commaSeparate}}</label> </div>',this.assettpl=this.assettpl+'</div><div class="row"><div class="col-md-12 col-sm-12 col-xs-12">',this.assettpl=this.assettpl+'<label class="cls-lbl-holding-desc"><i>{{assetclassname}}</i></label> </div></div></div><div class="col-md-2 col-sm-2 col-xs-2">',this.assettpl=this.assettpl+'<span class="pull-right"><i class="{{clsarrow}}"></i><br>',this.assettpl=this.assettpl+'<label class="cls-lbl-holding-desc" >{{gainloss_perc}}%</label> </span>',this.assettpl=this.assettpl+'</div><div class="col-md-2 col-sm-2 col-xs-2"><span class="pull-right cls-holding-links ">',this.assettpl=this.assettpl+'<a href="#Holding/security/{{assetclass}}" class="cls-holding-arrow"><i class="fa fa-angle-right fa-5x"></a></i></span></div></div></div></div></div></div>{{/tdata}}',$.get(app.applicationurl+"app/template/holding/AssetHolding.html",function(a){b.assetholdingpage=a,b.render()}),_app_route.route("Holding/security/:asset","Holding/security/",function(a){app.instance.dv.SecurityHoldingView?(app.instance.dv.SecurityHoldingView.assetclass=a,app.instance.dv.SecurityHoldingView.render()):app.instance.dv.SecurityHoldingView=new app.dv.SecurityHoldingView({el:"#maincontent",assetclass:a})})},render:function(){var a=[],b={},c="fa fa-caret-up fa-3x",d="";this.$el.html(this.assetholdingpage||"Hey Mohini!!! ");var e=_.filter(app.dc.holdingCollection.toJSON(),function(a){if(console.log("Account number : "+this.accountnumber),a.accountid==this.accountnumber)return!0},{accountnumber:this.accountnumber}),f=_.groupBy(e,"assetclasscode"),g={gainloss:0,gainloss_perc:0,marketvalue:0};_.each(f,function(b,e){g.marketvalue=_.reduce(b,function(a,b){return Big(a).plus(b.marketvalue).toString()},0),g.gainloss_perc=_.reduce(b,function(a,b){return Big(a).plus(b.gainloss_perc).toString()},0),g.gainloss_perc<0&&(c="fa fa-caret-down fa-3x"),d=(a.length+1)%2==0?"bg-aqua":"bg-teal",g.gainloss_perc=Math.abs(g.gainloss_perc),a[a.length]={assetclassname:b[0].assetclassname,assetclass:e,marketvalue:g.marketvalue,gainloss_perc:g.gainloss_perc,y:Number(g.marketvalue),name:b[0].assetclassname,clsbg:d,clsarrow:c}}),b={tdata:a},b.commaSeparate=function(){return function(a,b){return app.formatPrice.call(b(a))}},$("#asset_back").attr("href","#MyPortfolio/V1");var h=Mustache.to_html(this.assettpl,b);$("#assetlisting").html(h),app.trade.accountChartObj={id:"#assetgraph",data:a}}}),app.dv.SecurityHoldingView=Backbone.View.extend({initialize:function(a){var b=this;this.assetclass=a.assetclass,this.securitytpl="",this.securitytpl=this.securitytpl+'{{#tdata}}<div class="row"><div class="col-md-12 col-sm-12 col-xs-12"><div class="box cls-holding-box-shadow">',this.securitytpl=this.securitytpl+'<div class="box-body {{clsbg}}"><div class="row"><div class="col-md-10 col-sm-10 col-xs-10">',this.securitytpl=this.securitytpl+'<div class="row"><div class="col-md-12 col-sm-12 col-xs-12"><label class="cls-lbl-holding-amt">${{#commaSeparate}}{{marketvalue}}{{/commaSeparate}}</label>',this.securitytpl=this.securitytpl+'</div></div><div class="row">',this.securitytpl=this.securitytpl+'<div class="col-md-12 col-sm-12 col-xs-12"><label class="cls-lbl-holding-desc" ><i>{{security_name}}</i></label></div>',this.securitytpl=this.securitytpl+'</div></div><div class="col-md-2 col-sm-2 col-xs-2">',this.securitytpl=this.securitytpl+'<span class="pull-right"><i class="{{clsarrow}}"></i><br><label class="cls-lbl-holding-desc" >{{gainloss_perc}}%</label></span></div></div></div></div></div></div>{{/tdata}}',$.get(app.applicationurl+"app/template/holding/SecurityHolding.html",function(a){b.securityholdingpage=a,b.render()})},render:function(){var a={};this.$el.html(this.securityholdingpage);for(var b=app.instance.dv.AssetHoldingView.accountnumber,c=_.filter(app.dc.holdingCollection.toJSON(),function(a){if(a.accountid==this.accountnumber&&a.assetclasscode==this.assetclass)return!0},{accountnumber:b,assetclass:this.assetclass}),d=0;d<c.length;d++)c[d].y=Number(c[d].marketvalue),c[d].name=c[d].security_name,c[d].clsbg=clsbg=d%2==0?"bg-aqua":"bg-teal",c[d].gainloss_perc<0?c[d].clsarrow="fa fa-caret-down fa-3x":c[d].clsarrow="fa fa-caret-up fa-3x",c[d].gainloss_perc=Math.abs(c[d].gainloss_perc);app.trade.accountChartObj={id:"#securitygraph",data:c},a={tdata:c,accountnumber:b},a.commaSeparate=function(){return function(a,b){return app.formatPrice.call(b(a))}},$("#sec_back").attr("href","#Holding/asset/"+b);var e=Mustache.to_html(this.securitytpl,a);$("#securitylisting").html(e)}}),app.dc.holdingCollection=new(app.dc._generic({_reload:app._reload,data:{user_id:app.getData("_user_id")},_service:"dataset",_methods:{read:"dataset/AllHolding"},parse:function(a,b){return a.data}})),app.onGetHolding=function(a,b){app.instance.dv.HoldingView?app.dc.holdingCollection.fetch({reset:!0}):app.instance.dv.HoldingView=new app.dv.HoldingView({el:"#maincontent",paramhtml:b})},app.trade.onShowAccountHoldingChart=function(a){$('#holdinggraph a[data-toggle="tab"]').on("shown.bs.tab",function(b){app.createPieChart(a)})},app.dc.tradeaccounts=new(app.dc._generic({_reload:app._reload,data:{_reload:app._reload},_service:"dataset",_methods:{read:"dataset/UserAccount"},parse:function(a,b){return a.data}})),app.dc.tradecurrency=new(app.dc._generic({_reload:app._reload,data:{_reload:app._reload},_service:"dataset",_methods:{read:"dataset/tradecurrency"},parse:function(a,b){return a.data}})),app.dc.tradesecurity=new(app.dc._generic({_reload:app._reload,data:{_reload:app._reload},_service:"dataset",_methods:{read:"dataset/tradesecurity"},parse:function(a,b){return a.data}})),app.dm.trademodel=app.dm._generic({idAttribute:"req_id",_methods:{create:"trade/OnSaveTransRequest"},initialize:function(){this.on("invalid",function(a,b){alert(b)})},validate:function(a){var b="";if("CASH"==a.assetclass){if(b=app.trade.validatefrmcash(a),""!=b)return b}else if("EQ"==a.assetclass){if(b=app.trade.validatefrmequity(a),""!=b)return b}else if("FIS"==a.assetclass){if(b=app.trade.validatefrmbond(a),""!=b)return b}else if("MF"==a.assetclass&&(b=app.trade.validatefrmunitrust(a),""!=b))return b},parse:function(a){return null}}),app.trade.goBackToHoldingPage=function(){window.location.href="#MyPortfolio/V1"},app.trade.goBackToAssetHoldingPage=function(){window.location.href="#Holding/asset/"+app.instance.dv.AssetHoldingView.accountnumber},app.trade.loadAccountHoldingView=function(a){var b=[],c={},d={gainloss:0,gainloss_perc:0,marketvalue:0},e="fa fa-caret-up fa-3x",f="",g=a;if(g.el.innerHTML=g.holdingpage,0==app.dc.holdingCollection.toJSON().length)return $("#_noholding").show(),$("#_noholdingquote").html(quoteslist.getRandomQuote()),void $("#_withholding").hide();var h=_.groupBy(app.dc.holdingCollection.toJSON(),"accountid");for(var i in h){d={gainloss:0,gainloss_perc:0,marketvalue:0};for(var j=0;j<h[i].length;j++)d.gainloss=Number(Big(d.gainloss).plus(h[i][j].gainloss)),d.gainloss_perc=Number(Big(d.gainloss_perc).plus(h[i][j].gainloss_perc)),d.marketvalue=Number(Big(d.marketvalue).plus(h[i][j].marketvalue));d.gainloss_perc<0&&(e="fa fa-caret-down fa-3x"),d.gainloss_perc=Math.abs(d.gainloss_perc),f=(b.length+1)%2==0?"bg-aqua":"bg-teal",b[b.length]={accountid:i,gainloss:d.gainloss,gainloss_perc:d.gainloss_perc,marketvalue:d.marketvalue,name:i,y:d.marketvalue,clsbg:f,clsarrow:e}}c={tdata:b},c.commaSeparate=function(){return function(a,b){return app.formatPrice.call(b(a))}};var k=Mustache.to_html(g.accountTpl,c);$("#accountlisting").html(k),app.trade.accountChartObj={id:"#accountinggraph",data:b}},app.instance.dv.TradeView=null,app.instance.dv.TradeCashView=null,app.dv.TradeView=Backbone.View.extend({initialize:function(attrs){var $this=this;$.get(attrs.paramhtml,function(a){$this.tradetpl=a,$this.render()});var tradeoption=["cash","equity","bonds","unittrust"];_.each(tradeoption,function(option){_app_route.route("trade/:"+option,"trade/"+option,function(option){eval("app.trade.onOpen"+option+"Screen()")})})},render:function(){this.$el.html(this.tradetpl)}}),app.dv.TradeCashView=Backbone.View.extend({initialize:function(){var a=this;this.optionTpl="{{#tdata}}<option value='{{code}}'>{{name}}</option>{{/tdata}}",$.get(app.applicationurl+"app/template/trade/cash.html",function(b){a.tradecashtpl=b,a.render()})},render:function(){this.$el.html(this.tradecashtpl);var a=this;$("#frmcash #btndeposit").trigger("click"),app.addNumberMask(document.frmcash),app.dc.tradeaccounts.fetch({data:{asset_class:"CASH"},success:function(b){var c=Mustache.to_html("<option disabled selected value=''>Please select account</option>"+a.optionTpl,{tdata:app.dc.tradeaccounts.toJSON()});$("#frmcash #txtacct").html(c)}}),app.dc.tradecurrency.fetch({success:function(){var b=Mustache.to_html("<option disabled selected value=''>Please select currency</option>"+a.optionTpl,{tdata:app.dc.tradecurrency.toJSON()});$("#frmcash #txtcurrency").html(b)}})},events:{"click #frmcash #btnplacereq":"saveCashDet","click #frmcash #lbldeposit":"onDeposit","click #frmcash #lblwithdraw":"onWithdrawal","keypress #frmcash #txtamt":"checkNumberKeyPress"},saveCashDet:function(){app.trade.saveCashDet()},checkNumberKeyPress:function(a){if(!app.checkNumberKeyPress(a))return!1},onDeposit:function(){app.trade.onDeposit()},onWithdrawal:function(){app.trade.onWithdrawal()}}),app.trade.onGettradeDetails=function(a,b){app.instance.dv.TradeView=new app.dv.TradeView({el:"#maincontent",paramhtml:b}),app.instance.dv.TradeView.render()},app.trade.onOpencashScreen=function(){app.instance.dv.TradeCashView?app.instance.dv.TradeCashView.render():app.instance.dv.TradeCashView=new app.dv.TradeCashView({el:"#maincontent"})},app.trade.saveCashDet=function(){var a,b={};$("#frmcash [fieldname]").each(function(){a=$(this),b[a.attr("fieldname")]=a.prop("value")});var c=new app.dm.trademodel(b);c.save(null,{success:function(a,b){"unsuccess"==b.status?alert("Error while adding request"):(alert("Request has been added."),_app_route.navigate("Trade/V2",{trigger:!0}))},error:function(a,b){alert("Opps something went wrong.Try again"),console.log("Error : "+b)}})},app.trade.validatefrmcash=function(){var a=app.validateJQForm(document.frmcash);return"unsuccess"==a.status?a.error:""},app.trade.onDeposit=function(){$("#frmcash #trans_type").prop("value","CASH-IN")},app.trade.onWithdrawal=function(){$("#frmcash #trans_type").prop("value","CASH-OUT")},app.instance.dv.TradeEquityView=null,app.dv.TradeEquityView=Backbone.View.extend({initialize:function(){var a=this;this.optionTpl="{{#tdata}}<option value='{{code}}'>{{name}}</option>{{/tdata}}",$.get(app.applicationurl+"app/template/trade/equity.html",function(b){a.tradeequitytpl=b,a.render()})},render:function(){this.$el.html(this.tradeequitytpl);var a=this;$("#frmequity #lblbuy").trigger("click"),app.dc.tradeaccounts.fetch({data:{asset_class:"EQ"},success:function(b){var c=Mustache.to_html("<option disabled selected value=''>Please select account</option>"+a.optionTpl,{tdata:app.dc.tradeaccounts.toJSON()});$("#frmequity #txtequityacct").html(c)}}),app.dc.tradesecurity.fetch({data:{assetclass:"EQ"},success:function(){var b=Mustache.to_html("<option disabled selected value=''>Please select security</option>"+a.optionTpl,{tdata:app.dc.tradesecurity.toJSON()});$("#frmequity #txtequitysecurity").html(b)}})},events:{"click #frmequity #btnplacereq":"onsaveEquityDet","click #frmequity #lblbuy":"onEquityBuy","click #frmequity #lblsell":"onEquitySell","keypress #frmequity #txtequityamt":"checkNumberKeyPress","keypress #frmequity #txtequityqty":"checkNumberKeyPress"},checkNumberKeyPress:function(a){if(!app.checkNumberKeyPress(a))return!1},onEquityBuy:function(){app.trade.onEquityBuy()},onEquitySell:function(){app.trade.onEquitySell()},onsaveEquityDet:function(){app.trade.onsaveEquityDet()}}),app.trade.onOpenequityScreen=function(){app.instance.dv.TradeEquityView?app.instance.dv.TradeEquityView.render():app.instance.dv.TradeEquityView=new app.dv.TradeEquityView({el:"#maincontent"})},app.trade.onEquityBuy=function(){$("#frmequity #qtyblock").css("display","none"),$("#frmequity #amtblock").css("display","block"),$("#frmequity #txtequityqty").attr("validator",""),$("#frmequity #txtequityamt").attr("validator","nonEmpty,number"),$("#frmequity #trans_type").prop("value","EQ-BUY"),app.addNumberMask(document.frmequity)},app.trade.onEquitySell=function(){$("#frmequity #amtblock").css("display","none"),$("#frmequity #qtyblock").css("display","block"),$("#frmequity #txtequityqty").attr("validator","nonEmpty,number"),$("#frmequity #txtequityamt").attr("validator",""),$("#frmequity #trans_type").prop("value","EQ-SELL"),app.addNumberMask(document.frmequity)},app.trade.onsaveEquityDet=function(){var a,b={};$("#frmequity [fieldname]").each(function(){a=$(this),b[a.attr("fieldname")]=a.prop("value")});var c=new app.dm.trademodel(b);c.save(null,{success:function(a,b){"unsuccess"==b.status?alert("Error while adding request"):(alert("Request has been added."),_app_route.navigate("Trade/V2",{trigger:!0}))},error:function(a,b){alert("Opps something went wrong.Try again"),console.log("Error : "+b)}})},app.trade.validatefrmequity=function(a){var b=app.validateJQForm(document.frmequity);return"unsuccess"==b.status?b.error:""},app.instance.dv.TradeBondView=null,app.dv.TradeBondView=Backbone.View.extend({initialize:function(){var a=this;this.optionTpl="{{#tdata}}<option value='{{code}}'>{{name}}</option>{{/tdata}}",$.get(app.applicationurl+"app/template/trade/bond.html",function(b){a.tradebondtpl=b,a.render()})},render:function(){this.$el.html(this.tradebondtpl);var a=this;$("#frmbond #lblbuy").trigger("click"),app.dc.tradeaccounts.fetch({data:{asset_class:"FIS"},success:function(b){var c=Mustache.to_html("<option disabled selected value=''>Please select account</option>"+a.optionTpl,{tdata:app.dc.tradeaccounts.toJSON()});$("#frmbond #txtbondacct").html(c)}}),app.dc.tradesecurity.fetch({data:{assetclass:"FIS"},success:function(){var b=Mustache.to_html("<option disabled selected value=''>Please select security</option>"+a.optionTpl,{tdata:app.dc.tradesecurity.toJSON()});$("#frmbond #txtbondsecurity").html(b)}})},events:{"click #frmbond #btnplacereq":"onsaveBondDet","click #frmbond #lblbuy":"onBondBuy","click #frmbond #lblsell":"onBondSell","keypress #frmbond #txtbondamt":"checkNumberKeyPress","keypress #frmbond #txtbondqty":"checkNumberKeyPress"},checkNumberKeyPress:function(a){if(!app.checkNumberKeyPress(a))return!1},onBondBuy:function(){app.trade.onBondBuy()},onBondSell:function(){app.trade.onBondSell()},onsaveBondDet:function(){app.trade.onsaveBondDet()}}),app.trade.onOpenbondsScreen=function(){app.instance.dv.TradeBondView?app.instance.dv.TradeBondView.render():app.instance.dv.TradeBondView=new app.dv.TradeBondView({el:"#maincontent"})},app.trade.onBondBuy=function(){$("#frmbond #qtyblock").css("display","none"),$("#frmbond #amtblock").css("display","block"),$("#frmbond #txtbondqty").attr("validator",""),$("#frmbond #txtbondamt").attr("validator","nonEmpty,number"),$("#frmbond #trans_type").prop("value","FIS-BUY"),app.addNumberMask(document.frmbond)},app.trade.onBondSell=function(){$("#frmbond #amtblock").css("display","none"),$("#frmbond #qtyblock").css("display","block"),$("#frmbond #txtbondqty").attr("validator","nonEmpty,number"),$("#frmbond #txtbondamt").attr("validator",""),$("#frmbond #trans_type").prop("value","FIS-SELL"),app.addNumberMask(document.frmbond)},app.trade.onsaveBondDet=function(){var a,b={};$("#frmbond [fieldname]").each(function(){a=$(this),b[a.attr("fieldname")]=a.prop("value")});var c=new app.dm.trademodel(b);c.save(null,{success:function(a,b){"unsuccess"==b.status?alert("Error while adding request"):(alert("Request has been added."),_app_route.navigate("Trade/V2",{trigger:!0}))},error:function(a,b){alert("Opps something went wrong.Try again"),console.log("Error : "+b)}})},app.trade.validatefrmbond=function(a){var b=app.validateJQForm(document.frmbond);return"unsuccess"==b.status?b.error:""},app.instance.dv.TradeUnittrustView=null,app.dv.TradeUnittrustView=Backbone.View.extend({initialize:function(){var a=this;this.optionTpl="{{#tdata}}<option value='{{code}}'>{{name}}</option>{{/tdata}}",$.get(app.applicationurl+"app/template/trade/unittrust.html",function(b){a.tradeunittrusttpl=b,a.render()})},render:function(){this.$el.html(this.tradeunittrusttpl);var a=this;$("#frmunittrust #lblsubscribe").trigger("click"),app.dc.tradeaccounts.fetch({data:{asset_class:"MF"},success:function(b){var c=Mustache.to_html("<option disabled selected value=''>Please select account</option>"+a.optionTpl,{tdata:app.dc.tradeaccounts.toJSON()});$("#frmunittrust #txtunitacct").html(c)}}),app.dc.tradesecurity.fetch({data:{assetclass:"MF"},success:function(){var b=Mustache.to_html("<option disabled selected value=''>Please select security</option>"+a.optionTpl,{tdata:app.dc.tradesecurity.toJSON()});$("#frmunittrust #txtunitfund").html(b)}})},events:{"click #frmunittrust #btnplacereq":"onSaveUnitTrustDet","click #frmunittrust #lblsubscribe":"onUnitsubscribe","click #frmunittrust #lblredeem":"onUnitredeem","keypress #frmunittrust #txtunitamt":"checkNumberKeyPress","keypress #frmunittrust #txtunitqty":"checkNumberKeyPress"},checkNumberKeyPress:function(a){if(!app.checkNumberKeyPress(a))return!1},onUnitsubscribe:function(){app.trade.onUnitsubscribe()},onUnitredeem:function(){app.trade.onUnitredeem()},onSaveUnitTrustDet:function(){app.trade.onSaveUnitTrustDet()}}),app.trade.onOpenunittrustScreen=function(){app.instance.dv.TradeUnittrustView?app.instance.dv.TradeUnittrustView.render():app.instance.dv.TradeUnittrustView=new app.dv.TradeUnittrustView({el:"#maincontent"})},app.trade.onUnitsubscribe=function(){$("#frmunittrust #qtyblock").css("display","none"),$("#frmunittrust #amtblock").css("display","block"),$("#frmunittrust #txtunitqty").attr("validator","").removeClass("iwebz-numbermask"),$("#frmunittrust #txtunitamt").attr("validator","nonEmpty,number").addClass("iwebz-numbermask"),$("#frmunittrust #trans_type").prop("value","MF-BUY"),app.addNumberMask(document.frmunittrust)},app.trade.onUnitredeem=function(){$("#frmunittrust #amtblock").css("display","none"),$("#frmunittrust #qtyblock").css("display","block"),$("#frmunittrust #txtunitqty").attr("validator","nonEmpty,number").addClass("iwebz-numbermask"),$("#frmunittrust #txtunitamt").attr("validator","").removeClass("iwebz-numbermask"),$("#frmunittrust #trans_type").prop("value","MF-SELL"),app.addNumberMask(document.frmunittrust)},app.trade.onSaveUnitTrustDet=function(){var a,b={};$("#frmunittrust [fieldname]").each(function(){a=$(this),b[a.attr("fieldname")]=a.prop("value")});var c=new app.dm.trademodel(b);c.save(null,{success:function(a,b){"unsuccess"==b.status?alert("Error while adding request"):(alert("Request has been added."),_app_route.navigate("Trade/V2",{trigger:!0}))},error:function(a,b){alert("Opps something went wrong.Try again"),console.log("Error : "+b)}})},app.trade.validatefrmunitrust=function(a){var b=app.validateJQForm(frmunittrust);return"unsuccess"==b.status?b.error:""},app.instance.dv.ContactView=null,app.onGetContactUsDetails=function(a,b){app.instance.dv.ContactView?app.dm.contactModel.fetch():app.instance.dv.ContactView=new app.dv.ContactView({el:"#maincontent",paramhtml:b})},app.dm.contactModel=new(app.dm._generic({_reload:app._reload,data:{user_id:app.getData("_user_id")},defaults:{rm_id:"",name:"",personal_no:"",office_no:"",mail:""},_service:"dataset",_methods:{read:"dataset/RMData"},parse:function(a,b){return a.data[0]}})),app.dv.ContactView=Backbone.View.extend({initialize:function(a){var b=this;this.model=app.dm.contactModel,this.model.on("sync",this.render,this),$.get(a.paramhtml,function(a){b.template=a,b.model.fetch()})},render:function(){var a=_.template(this.template),b=this.model.toJSON();return b.off_address=app.dm._appsettings.get("off_address"),this.$el.html(a(b)),""==b.name?($("#frmcontactus #rmblck").hide(),$("#frmcontactus #_norm").show()):($("#frmcontactus #rmblck").show(),$("#frmcontactus #_norm").hide()),this}}),app._settings={},app.instance.dv.SettingsView=null,app.dm.PasswordParamModel=new(app.dm._generic({_reload:app._reload,_service:"dataset",_methods:{read:"dataset/passwordparameter"}})),app.dv.SettingsView=Backbone.View.extend({initialize:function(a){var b=this;$.get(a.paramhtml,function(a){b.settingpage=a,b.render()})},render:function(){this.$el.html(this.settingpage);var a=null,b="",c=null,d="";return $("#frmAlert input[type=checkbox]").each(function(){a=$(this),b=a.attr("fieldname"),c=app.dc._usersettings.get(b),c&&(d=c.get("subscribe")||"N","Y"==d&&a.attr("checked",!0))}),this},events:{"click #frmsettings #btnchangepwd":"validatePwdComposition","change #frmAlert input[type=checkbox]":"saveAlerts"},saveAlerts:function(a){var b=$("#"+a.currentTarget.id),c=b.attr("fieldname"),d=b.is(":checked")?"Y":"N",e=app.dc._usersettings.get(c);e&&(e.set({subscribe:d}),e.save({success:function(a){console.log(a)}}))},validatePwdComposition:function(){var a=$("#frmsettings #txtoldpwd").prop("value"),b=$("#frmsettings #txtnewpwd").prop("value"),c=$("#frmsettings #txtcnfrmpwd").prop("value"),d=app.getData("_user_id"),e=app._settings.validatePwd(c,b,d);return"unsuccess"==e.status?void alert(e.error):void app._settings.updatePassword(a,c,b,d)}}),app.onGetUserSettings=function(a,b){app.instance.dv.SettingsView?app.instance.dv.SettingsView.render():app.instance.dv.SettingsView=new app.dv.SettingsView({el:"#maincontent",paramhtml:b}),app.dm.PasswordParamModel.fetch()},app._settings.validatePwd=function(a,b,c){var d=app.validateJQForm(document.frmsettings);if("unsuccess"==d.status)return{status:"unsuccess",msg:"",error:d.error};var e=app.dm.PasswordParamModel.toJSON(),f=[];if(b!=a)return{status:"unsuccess",msg:"",error:"New/confirm password mismatch."};for(key in e)"bshouldalphanumeric"==key&&"true"==e[key]&&"0"==app._settings.checkIfAlphaNumeric(a)&&(f[f.length]="Should be alphanumeric."),"limitlength"==key&&("true"==e[key]?(e.minpasswordlength=e.minpasswordlength||5,e.maxpasswordlength=e.maxpasswordlength||20,(a.length<e.minpasswordlength||a.length>e.maxpasswordlength)&&(f[f.length]="Should have at least "+e.minpasswordlength+" alphanumeric characters and less than "+e.maxpasswordlength+" alphanumeric characters long.")):(a.length<5||a.length>20)&&(f[f.length]="Should have at least 5 alphanumeric characters and less than 20 alphanumeric characters long.")),"bshouldcapitalize"==key&&"true"==e[key].toLowerCase()&&0==app._settings.checkIfCapLetterExist(a)&&(f[f.length]="Should have at least 1 capital alphabet."),"shouldcontain1lowcaselet"==key&&"true"==e[key].toLowerCase()&&0==app._settings.chkIfLowCaseLetterExist(a)&&(f[f.length]="Should have at least 1 lower case alphabet."),"allowsspecialchr"==key&&"true"==e[key].toLowerCase()&&0==app._settings.chkSpecialCharByValue(a)&&(f[f.length]="Should have at least 1 special character."),"matchpassworduserid"==key&&"true"==e[key].toLowerCase()&&0==app._settings.checkIfUserPresent(a,c)&&(f[f.length]="Should not contain your user id."),"checkconsecutivechar"==key&&"true"==e[key]&&0==app._settings.checkConsecutiveChar(a)&&(f[f.length]="Shouldn't contain consecutive characters."),"checkdateexist"==key&&"true"==e[key]&&(app._settings.chkIfDateExistInPwd(a)||(f[f.length]="Shouldn't contain any aspect of the date."));return 0==f.length?{status:"success",msg:""}:{status:"unsuccess",msg:"",error:f.join("\n"),passval:"3"}},app._settings.checkIfAlphaNumeric=function(a){for(var b=!1,c=!1,d="",e=0,f=a.length;e<f;e++)d=a.charCodeAt(e),d>47&&d<59&&(b=!0),(d>64&&d<91||d>96&&d<123)&&(c=!0);return 0==b||0==c?0:1},app._settings.checkIfCapLetterExist=function(a){for(var b,c=0,d=0;d<a.length;d++)b=a.charCodeAt(d),b>=65&&b<=90&&(c=1);return 0!=c},app._settings.chkIfLowCaseLetterExist=function(a){for(var b,c=0,d=0;d<a.length;d++)b=a.charCodeAt(d),b>=97&&b<=122&&(c=1);return 0!=c},app._settings.chkSpecialCharByValue=function(a){for(var b="~`!@#$%^&*()+=-[]\\';,./{}|\":<>?",c=0,d=0;d<a.length;d++)b.indexOf(a.charAt(d))!=-1&&(c=1);return 0!=c},app._settings.checkIfUserPresent=function(a,b){a=a.toLowerCase(),b=b.toLowerCase();var c=a.indexOf(b);return c==-1&&(c==-1||void 0)},app._settings.checkConsecutiveChar=function(a){a=a,a=a.toLowerCase();for(var b=a.charAt(0),c=!1,d=1,e=a.length;d<e;d++){if(b==a.charAt(d),b==a.charAt(d)){c=!0;break}b=a.charAt(d)}return!c},app._settings.chkIfDateExistInPwd=function(a){a=a.toLowerCase();var b=new Array("january","february","march","april","may","june","july","august","september","october","november","december","jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"),c=new Array("sunday","monday","tuesday","wednesday","thursday","friday","saturday","sun","mon","tue","wed","thu","fri","sat");
dateflag=!1,monthflag=!1;for(var d=-1,e=0,f=b.length;e<f;e++)if(d=a.indexOf(b[e]),d!=-1){monthflag=!0;break}d=-1;for(var e=0,f=c.length;e<f;e++)if(d=a.indexOf(c[e]),d!=-1){dateflag=!0;break}return!monthflag&&!dateflag},app._settings.updatePassword=function(oldpwd,pwd,newpwd){var jstring={};jstring.oldpass=app._settings.hashAllPwdField(oldpwd),jstring.newpass=app._settings.hashAllPwdField(pwd),jstring.confirmpass=app._settings.hashAllPwdField(newpwd),app.sendRequest({url:"REST/update/useradmin/changepassword",fn:function(response){if(response=eval("("+response+")"),1==response.passval)alert("Password changed successfully .User will be logged out!!!"),app.onLogout();else{if(2==response.passval)return alert("Error : Please Check Old Password."),$("#frmsettings #txtoldpwd").val(""),$("#frmsettings #txtnewpwd").val(""),void $("#frmsettings #txtcnfrmpwd").val("");if(3==response.passval||0==response.passval)return alert("Error : "+response.error.split(",").join("<br>")),$("#frmsettings  #txtoldpwd").val(""),$("#frmsettings  #txtnewpwd").val(""),void $("#frmsettings  #txtcnfrmpwd").val("")}},async:!0,data:{_ticket:app.getData("_ticket"),jstring:JSON.stringify(jstring)}})},app._settings.hashAllPwdField=function(a){var b="";return b=new jsSHA(a,"TEXT"),b=b.getHash("SHA-512","HEX")},app.instance.dv.UserProfileView=null,app.userProfile={},app.onGetUserProfile=function(a,b){app.instance.dv.UserProfileView?app.dm.userProfileModel.fetch({success:function(){app.instance.dv.UserProfileView.render()}}):app.instance.dv.UserProfileView=new app.dv.UserProfileView({el:"#maincontent",paramhtml:b})},app.dm.userProfileModel=new(app.dm._generic({_reload:app._reload,idAttribute:"user_id",_service:"dataset",_methods:{read:"dataset/UserProfile",update:"useradmin/onupdateuserprofile"},parse:function(a,b){if("success"==a.status&&a.vdata)return a.vdata[0]},validate:function(a){return app.dm.userProfileModel.changedAttributes(a)?app.validate("date",$("#frmprofile #dob"))?app.dobDateValidation($("#frmprofile #dob"))?void 0:(alert("Date of birth cannot exceed current date."),"Date of birth cannot exceed current date."):"Invalid date of birth.":(app.instance.dv.UserProfileView.render(),"Nothing changed")}})),app.dv.UserProfileView=Backbone.View.extend({initialize:function(a){var b=this;this.model=app.dm.userProfileModel,$.get(a.paramhtml,function(a){b.template=a,app.dm.userProfileModel.fetch({success:function(){b.render()}})})},render:function(){var a=_.template(this.template);return this.$el.html(a(this.model.toJSON())),app.createCalendar($("#frmprofile")),this},events:{"click #frmprofile #btneditdetail":"userProfileEdit","click #frmprofile #btnsaveprofile":"userProfileSave","click #frmprofile #btncancel":"userProfileCancel","keypress #frmprofile #txtmob":"checkNumberKeyPress"},checkNumberKeyPress:function(a){if(!app.checkNumberKeyPress(a))return!1},userProfileEdit:function(){$("#frmprofile #editdetails").css("display","block"),$("#frmprofile #showdetails").css("display","none")},userProfileSave:function(){app.userProfile.userProfileSave()},userProfileCancel:function(){app.userProfile.userProfileCancel()}}),app.userProfile.userProfileSave=function(){var a,b={};$("#frmprofile [fieldname]").each(function(){a=$(this),b[a.attr("fieldname")]=a.prop("value")}),app.dm.userProfileModel.save(b,{success:function(a,b){"success"==b.status?app.instance.dv.UserProfileView.render():(alert("Unable to save the details.Please try again."),app.dm.userProfileModel.set(app.dm.userProfileModel.previousAttributes()))}})},app.userProfile.userProfileCancel=function(){app.instance.dv.UserProfileView.render()},app.fp={},app.instance.dv.financialPView=null,app.dv.financialPView=Backbone.View.extend({initialize:function(a){var b=this;$.get(a.paramhtml,function(a){b.template=a,b.render(),app.fp.risktpl(),app.dc.riskmaster.fetch()}),_app_route.route("FinancialPlanning/result/:riskprofile","FinancialPlanning/result",function(a){app.instance.dv.RPAllocation=new app.dv.RPAllocation({riskprofile:a,el:"#maincontent"})})},render:function(){return this.$el.html(this.template),this},events:{"click #btnRPNext":"goToNextQuest","click #btnRPPrev":"goToPrevQuest","click #frmriskprofile input":"calculateProgress","click #frmriskprofile #btnRPSubmit":"onSubmitRiskProfile"},goToNextQuest:function(){app.fp.goToNextQuest()},goToPrevQuest:function(){app.fp.goToPrevQuest()},calculateProgress:function(a){app.fp.calculateProgress(a)},onSubmitRiskProfile:function(a){app.fp.onSubmitRiskProfile()}}),app.dv.RPAllocation=Backbone.View.extend({initialize:function(a){var b=this;this.riskprofile=a.riskprofile,$.get(app.applicationurl+"app/template/financialplanning/ModelPortfolio.html",function(a){b.template=a,b.render()})},render:function(){return this.$el.html(this.template),app.fp.createRPAllocationCharts(this,this.riskprofile),this},events:{"click #btnRecalculate":"onRecalculate"},onRecalculate:function(){_app_route.navigate("FinancialPlanning/V3",{trigger:!0})}}),app.dc.RPAllocation=app.dc._generic({_methods:{read:"dataset/riskprofileallocation"},parse:function(a){return a.vdata.status&&"unsuccess"==a.vdata.status?{}:a.vdata.data}}),app.dc._financialPQuestion=new(app.dc._generic({data:{user_id:app.getData("_user_id")},_methods:{read:"dataset/riskquestion"},parse:function(a){return a.vdata.status&&"unsuccess"==a.vdata.status?{}:a.vdata.data}})),app.dc.riskmaster=new(app.dc._generic({_methods:{read:"dataset/riskdefn"},parse:function(a){return a.vdata.status&&"unsuccess"==a.vdata.status?{}:a.vdata.data}})),app.dc._financialPAnswer=new(app.dc._generic({data:{user_id:app.getData("_user_id")},_methods:{read:"dataset/riskanswer"},parse:function(a){if("success"==a.status&&a.vdata)return a.vdata.status&&"unsuccess"==a.vdata.status?{}:a.vdata.data}})),app.onGetFinancialPlanning=function(a,b){app.instance.dv.financialPView?(app.instance.dv.financialPView.render(),app.fp.risktpl(),app.dc.riskmaster.fetch()):app.instance.dv.financialPView=new app.dv.financialPView({el:"#maincontent",paramhtml:b})},app.fp.risktpl=function(a){var b;app.dc._financialPQuestion.fetch({success:function(a,c){b=a.toJSON(),app.dc._financialPAnswer.fetch({success:function(a,c){var d="",e=null;return d=app.fp.createQAhtml(b,a),$("#riskprofile").html(d),$("#qtn_attempt").html("0 of "+b.length+" answered"),e=$("#frmriskprofile .cls-rp-qtnansblock").first(),0!=e.length&&e.addClass("active"),$("html, body").animate({scrollTop:e.offset().top-50},100),d}})}})},app.fp.createQAhtml=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++){c[c.length]='<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 cls-rp-qtnansblock" id="Q'+a[e].option_id+'">',c[c.length]='<label class="cls-rp-qtn">'+(e+1)+". "+a[e].option_name+"</label>",d=_.filter(b.toJSON(),function(a){if(a.option_id==this.option_id)return!0},{option_id:a[e].option_id});for(var f=0;f<d.length;f++)"Y"==a[e].multi_select?c[c.length]='<div class="checkbox cls-rp-ans"><label><input type="checkbox" _others="'+d[f].is_others+'" name="AQ'+a[e].option_id+'" id="AQ'+d[f].srno+'" class="cls-rp-inptcntrl" value="'+d[f].weight+'">'+d[f].value_name+"</label>":c[c.length]='<div class="radio cls-rp-ans"><label><input type="radio" class="cls-rp-inptcntrl"  _others="'+d[f].is_others+'" name="AQ'+a[e].option_id+'" id="AQ'+d[f].srno+'" value="'+d[f].weight+'">'+d[f].value_name+"</label>","Y"==d[f].is_others&&(c[c.length]='<br><input class="form-control input-lg login-input" type="text"  name="txtAQ'+a[e].option_id+'" id="txtAQ'+d[f].srno+'" value="">'),c[c.length]="</div>";"Y"==a[e].multi_select&&(c[c.length]='<div class="checkbox cls-rp-ans"><label><input type="button" onclick="app.fp.goToNextQuest();" value="OK" name="btnok'+a[e].option_id+'" id="btnok'+a[e].option_id+'" class="btn btn-block btn-primary"></label> </div>'),a.length-1==e&&(c[c.length]='<div style="margin-top:100px;" id="divsubmit"><button type="button" id="btnRPSubmit" class="btn btn-block btn-primary btn-lg">Submit</button></div>'),c[c.length]="</div>"}return c.join(" ")},app.fp.goToNextQuest=function(a){var b="",c=null,d=null;a?c=$("#frmriskprofile #"+a).next(".cls-rp-qtnansblock"):(d=$("#frmriskprofile .cls-rp-qtnansblock.active"),c=d.next(".cls-rp-qtnansblock")),0!=c.length?($("#frmriskprofile .cls-rp-qtnansblock").removeClass("active"),c.addClass("active"),b=c.attr("id"),$("html, body").animate({scrollTop:$("#"+b).offset().top-50},1e3)):$("html, body").animate({scrollTop:$("#divsubmit").offset().top},500)},app.fp.goToPrevQuest=function(){var a="",b=$("#frmriskprofile .cls-rp-qtnansblock.active").prev(".cls-rp-qtnansblock");0!=b.length&&($("#frmriskprofile .cls-rp-qtnansblock").removeClass("active"),b.addClass("active"),a=b.attr("id"),$("html, body").animate({scrollTop:$("#"+a).offset().top-50},1e3))},app.fp.calculateProgress=function(a){var b,c=app.dc._financialPQuestion.length,d=0,e=!1,f=null;f=$("#"+a.target.id),$("#frmriskprofile .cls-rp-qtnansblock").removeClass("active"),f.parents(".cls-rp-qtnansblock").addClass("active"),$("#frmriskprofile .cls-rp-qtnansblock").each(function(a){e=$("#frmriskprofile [name=A"+this.id+"]").is(":checked"),e&&d++}),$("#frmriskprofile #txtanswercount").prop("value",d);var g=Math.ceil(d/c*100);$("#progressbar").css("width",g+"%"),$("#qtn_attempt").html(d+" of "+c+" answered"),"Y"==f.attr("_others")||"checkbox"==f.attr("type")?(b=$("#txt"+a.target.id),0!=b.length&&b.focus()):app.fp.goToNextQuest(this.id)},app.fp.onSubmitRiskProfile=function(){var a=null,b=0,c="",d=app.dc.riskmaster.toJSON(),e=$("#frmriskprofile #txtanswercount").prop("value");if(e!=app.dc._financialPQuestion.length)return void alert("Please answer all the question.");$("#frmriskprofile input").each(function(c){a=$(this),a.is(":checked")&&(b+=Number(a.prop("value")))});for(var f=0;f<d.length;f++)if(b>d[f].weight_min&&b<d[f].weight_max){c=d[f].riskprofile_name;break}_app_route.navigate("FinancialPlanning/result/"+c,{trigger:!0})},app.fp.createRPAllocationCharts=function(a,b){app.fp.RPAllocationCol=new app.dc.RPAllocation,app.fp.RPAllocationCol.fetch({data:{riskprofile:b},success:function(a,c){var d=[],e=[],f=[],g={},h=_.groupBy(a.toJSON(),"securitysymbol"),i=0;for(var j in h){for(var k=0;k<h[j].length;k++)i=Number(Big(i).plus(h[j][k].sec_weight));d[d.length]={name:h[j][0].securitysymbol,y:i}}h=_.groupBy(a.toJSON(),"industry"),i=0;for(var j in h){for(var k=0;k<h[j].length;k++)i=Number(Big(i).plus(h[j][k].sec_weight));e[e.length]={name:h[j][0].industryname,y:i}}h=_.groupBy(a.toJSON(),"asset_class_code"),i=0;for(var j in h){for(var k=0;k<h[j].length;k++)i=Number(Big(i).plus(h[j][k].sec_weight));f[f.length]={name:h[j][0].asset_class_name,y:i}}$("#info_riskprofile").html(b),g={id:"#securitywise_chart",data:d},app.createPieChart(g),g={id:"#sectorwise_chart",data:e},app.createPieChart(g),g={id:"#asset_chart",data:f},app.createPieChart(g)}})},app.newsfeed={},app.dc._newsfeed=app.dc._generic({data:{user_id:app.getData("_user_id")},_methods:{read:"dataset/newsfeed"},parse:function(a){if("success"==a.status&&a.vdata)return a.vdata}}),app.onGetNewsFeed=function(){app.newsfeed._newsfeedCol=new app.dc._newsfeed,app.newsfeed._newsfeedCol.fetch({success:function(a){var b="";b='<ul class="cls-newsfeed-ul">{{#data}}<li><a href="{{url}}" target="_blank">{{title}}</a></li>{{/data}}</ul>',b=Mustache.to_html(b,{data:a.toJSON()}),$("#maincontent").html(b)}})};